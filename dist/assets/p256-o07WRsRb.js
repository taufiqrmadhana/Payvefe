import{X as Re,Y as ze,u as S,l as $e,Z as _,_ as F,$ as G,a0 as he,a1 as Ne,F as _e,B as d,a2 as Ie,a3 as He,a4 as Ae,a5 as Fe,a6 as We,a7 as Ke,a8 as Ze,n as m,a9 as I,A as D,q as Xe,b as Ye,k as E,x as Je,z as Qe,aa as qe,ab as et,ac as Ee,ad as tt,ae as at,af as nt,ag as rt,f as B,o as it,ah as st,ai as ot,aj as ft,ak as ut,al as ct,am as Pe,an as xe,ao as dt,ap as pt,aq as yt}from"./index-CUXA16Je.js";function mt(e){const{source:t}=e,a=new Map,n=new Re(8192),i=new Map,o=({address:r,chainId:s})=>`${r}.${s}`;return{async consume({address:r,chainId:s,client:u}){const c=o({address:r,chainId:s}),p=this.get({address:r,chainId:s,client:u});this.increment({address:r,chainId:s});const l=await p;return await t.set({address:r,chainId:s},l),n.set(c,l),l},async increment({address:r,chainId:s}){const u=o({address:r,chainId:s}),c=a.get(u)??0;a.set(u,c+1)},async get({address:r,chainId:s,client:u}){const c=o({address:r,chainId:s});let p=i.get(c);return p||(p=(async()=>{try{const h=await t.get({address:r,chainId:s,client:u}),f=n.get(c)??0;return f>0&&h<=f?f+1:(n.delete(c),h)}finally{this.reset({address:r,chainId:s})}})(),i.set(c,p)),(a.get(c)??0)+await p},reset({address:r,chainId:s}){const u=o({address:r,chainId:s});a.delete(u),i.delete(u)}}}const lt="0x6492649264926492649264926492649264926492649264926492649264926492";function K(e){const{address:t,data:a,signature:n,to:i="hex"}=e,o=ze([S([{type:"address"},{type:"bytes"},{type:"bytes"}],[t,a,n]),lt]);return i==="hex"?o:$e(o)}async function gt(e,t){var u;const{account:a=e.account,chainId:n,nonce:i}=t;if(!a)throw new _({docsPath:"/docs/eip7702/prepareAuthorization"});const o=F(a),r=(()=>{if(t.executor)return t.executor==="self"?t.executor:F(t.executor)})(),s={address:t.contractAddress??t.address,chainId:n,nonce:i};return typeof s.chainId>"u"&&(s.chainId=((u=e.chain)==null?void 0:u.id)??await G(e,he,"getChainId")({})),typeof s.nonce>"u"&&(s.nonce=await G(e,Ne,"getTransactionCount")({address:o.address,blockTag:"pending"}),(r==="self"||r!=null&&r.address&&_e(r.address,o.address))&&(s.nonce+=1)),s}class bt extends d{constructor(t){super(`Call bundle failed with status: ${t.statusCode}`,{name:"BundleFailedError"}),Object.defineProperty(this,"result",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.result=t}}async function Kt(e,t){const{id:a,pollingInterval:n=e.pollingInterval,status:i=({statusCode:b})=>b===200||b>=300,retryCount:o=4,retryDelay:r=({count:b})=>~~(1<<b)*200,timeout:s=6e4,throwOnFailure:u=!1}=t,c=Ie(["waitForCallsStatus",e.uid,a]),{promise:p,resolve:l,reject:h}=He();let f;const x=Ae(c,{resolve:l,reject:h},b=>{const P=Fe(async()=>{const v=g=>{clearTimeout(f),P(),g(),x()};try{const g=await We(async()=>{const O=await G(e,Ke,"getCallsStatus")({id:a});if(u&&O.status==="failure")throw new bt(O);return O},{retryCount:o,delay:r});if(!i(g))return;v(()=>b.resolve(g))}catch(g){v(()=>b.reject(g))}},{interval:n,emitOnBegin:!0});return P});return f=s?setTimeout(()=>{x(),clearTimeout(f),h(new wt({id:a}))},s):void 0,await p}class wt extends d{constructor({id:t}){super(`Timed out while waiting for call bundle with id "${t}" to be confirmed.`,{name:"WaitForCallsStatusTimeoutError"})}}function Zt(e){const{r:t,s:a}=Ze.Signature.fromCompact(e.slice(2,130)),n=+`0x${e.slice(130)}`,[i,o]=(()=>{if(n===0||n===1)return[void 0,n];if(n===27)return[BigInt(n),0];if(n===28)return[BigInt(n),1];throw new Error("Invalid yParityOrV value")})();return typeof i<"u"?{r:m(t,{size:32}),s:m(a,{size:32}),v:i,yParity:o}:{r:m(t,{size:32}),s:m(a,{size:32}),yParity:o}}function H(e){return new Promise((t,a)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>a(e.error)})}function ht(e,t){const a=indexedDB.open(e);a.onupgradeneeded=()=>a.result.createObjectStore(t);const n=H(a);return(i,o)=>n.then(r=>o(r.transaction(t,i).objectStore(t)))}let Z;function Oe(){return Z||(Z=ht("keyval-store","keyval")),Z}function Xt(e,t=Oe()){return t("readonly",a=>H(a.get(e)))}function Yt(e,t,a=Oe()){return a("readwrite",n=>(n.put(t,e),H(n.transaction)))}function Jt(e,t=Oe()){return t("readwrite",a=>(a.delete(e),H(a.transaction)))}const Qt=[{inputs:[{name:"preOpGas",type:"uint256"},{name:"paid",type:"uint256"},{name:"validAfter",type:"uint48"},{name:"validUntil",type:"uint48"},{name:"targetSuccess",type:"bool"},{name:"targetResult",type:"bytes"}],name:"ExecutionResult",type:"error"},{inputs:[{name:"opIndex",type:"uint256"},{name:"reason",type:"string"}],name:"FailedOp",type:"error"},{inputs:[{name:"sender",type:"address"}],name:"SenderAddressResult",type:"error"},{inputs:[{name:"aggregator",type:"address"}],name:"SignatureValidationFailed",type:"error"},{inputs:[{components:[{name:"preOpGas",type:"uint256"},{name:"prefund",type:"uint256"},{name:"sigFailed",type:"bool"},{name:"validAfter",type:"uint48"},{name:"validUntil",type:"uint48"},{name:"paymasterContext",type:"bytes"}],name:"returnInfo",type:"tuple"},{components:[{name:"stake",type:"uint256"},{name:"unstakeDelaySec",type:"uint256"}],name:"senderInfo",type:"tuple"},{components:[{name:"stake",type:"uint256"},{name:"unstakeDelaySec",type:"uint256"}],name:"factoryInfo",type:"tuple"},{components:[{name:"stake",type:"uint256"},{name:"unstakeDelaySec",type:"uint256"}],name:"paymasterInfo",type:"tuple"}],name:"ValidationResult",type:"error"},{inputs:[{components:[{name:"preOpGas",type:"uint256"},{name:"prefund",type:"uint256"},{name:"sigFailed",type:"bool"},{name:"validAfter",type:"uint48"},{name:"validUntil",type:"uint48"},{name:"paymasterContext",type:"bytes"}],name:"returnInfo",type:"tuple"},{components:[{name:"stake",type:"uint256"},{name:"unstakeDelaySec",type:"uint256"}],name:"senderInfo",type:"tuple"},{components:[{name:"stake",type:"uint256"},{name:"unstakeDelaySec",type:"uint256"}],name:"factoryInfo",type:"tuple"},{components:[{name:"stake",type:"uint256"},{name:"unstakeDelaySec",type:"uint256"}],name:"paymasterInfo",type:"tuple"},{components:[{name:"aggregator",type:"address"},{components:[{name:"stake",type:"uint256"},{name:"unstakeDelaySec",type:"uint256"}],name:"stakeInfo",type:"tuple"}],name:"aggregatorInfo",type:"tuple"}],name:"ValidationResultWithAggregation",type:"error"},{anonymous:!1,inputs:[{indexed:!0,name:"userOpHash",type:"bytes32"},{indexed:!0,name:"sender",type:"address"},{indexed:!1,name:"factory",type:"address"},{indexed:!1,name:"paymaster",type:"address"}],name:"AccountDeployed",type:"event"},{anonymous:!1,inputs:[],name:"BeforeExecution",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"account",type:"address"},{indexed:!1,name:"totalDeposit",type:"uint256"}],name:"Deposited",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"aggregator",type:"address"}],name:"SignatureAggregatorChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"account",type:"address"},{indexed:!1,name:"totalStaked",type:"uint256"},{indexed:!1,name:"unstakeDelaySec",type:"uint256"}],name:"StakeLocked",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"account",type:"address"},{indexed:!1,name:"withdrawTime",type:"uint256"}],name:"StakeUnlocked",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"account",type:"address"},{indexed:!1,name:"withdrawAddress",type:"address"},{indexed:!1,name:"amount",type:"uint256"}],name:"StakeWithdrawn",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"userOpHash",type:"bytes32"},{indexed:!0,name:"sender",type:"address"},{indexed:!0,name:"paymaster",type:"address"},{indexed:!1,name:"nonce",type:"uint256"},{indexed:!1,name:"success",type:"bool"},{indexed:!1,name:"actualGasCost",type:"uint256"},{indexed:!1,name:"actualGasUsed",type:"uint256"}],name:"UserOperationEvent",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"userOpHash",type:"bytes32"},{indexed:!0,name:"sender",type:"address"},{indexed:!1,name:"nonce",type:"uint256"},{indexed:!1,name:"revertReason",type:"bytes"}],name:"UserOperationRevertReason",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"account",type:"address"},{indexed:!1,name:"withdrawAddress",type:"address"},{indexed:!1,name:"amount",type:"uint256"}],name:"Withdrawn",type:"event"},{inputs:[],name:"SIG_VALIDATION_FAILED",outputs:[{name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{name:"initCode",type:"bytes"},{name:"sender",type:"address"},{name:"paymasterAndData",type:"bytes"}],name:"_validateSenderAndPaymaster",outputs:[],stateMutability:"view",type:"function"},{inputs:[{name:"unstakeDelaySec",type:"uint32"}],name:"addStake",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{name:"account",type:"address"}],name:"balanceOf",outputs:[{name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{name:"account",type:"address"}],name:"depositTo",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{name:"",type:"address"}],name:"deposits",outputs:[{name:"deposit",type:"uint112"},{name:"staked",type:"bool"},{name:"stake",type:"uint112"},{name:"unstakeDelaySec",type:"uint32"},{name:"withdrawTime",type:"uint48"}],stateMutability:"view",type:"function"},{inputs:[{name:"account",type:"address"}],name:"getDepositInfo",outputs:[{components:[{name:"deposit",type:"uint112"},{name:"staked",type:"bool"},{name:"stake",type:"uint112"},{name:"unstakeDelaySec",type:"uint32"},{name:"withdrawTime",type:"uint48"}],name:"info",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[{name:"sender",type:"address"},{name:"key",type:"uint192"}],name:"getNonce",outputs:[{name:"nonce",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{name:"initCode",type:"bytes"}],name:"getSenderAddress",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{components:[{name:"sender",type:"address"},{name:"nonce",type:"uint256"},{name:"initCode",type:"bytes"},{name:"callData",type:"bytes"},{name:"callGasLimit",type:"uint256"},{name:"verificationGasLimit",type:"uint256"},{name:"preVerificationGas",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymasterAndData",type:"bytes"},{name:"signature",type:"bytes"}],name:"userOp",type:"tuple"}],name:"getUserOpHash",outputs:[{name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{components:[{components:[{name:"sender",type:"address"},{name:"nonce",type:"uint256"},{name:"initCode",type:"bytes"},{name:"callData",type:"bytes"},{name:"callGasLimit",type:"uint256"},{name:"verificationGasLimit",type:"uint256"},{name:"preVerificationGas",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymasterAndData",type:"bytes"},{name:"signature",type:"bytes"}],name:"userOps",type:"tuple[]"},{name:"aggregator",type:"address"},{name:"signature",type:"bytes"}],name:"opsPerAggregator",type:"tuple[]"},{name:"beneficiary",type:"address"}],name:"handleAggregatedOps",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{components:[{name:"sender",type:"address"},{name:"nonce",type:"uint256"},{name:"initCode",type:"bytes"},{name:"callData",type:"bytes"},{name:"callGasLimit",type:"uint256"},{name:"verificationGasLimit",type:"uint256"},{name:"preVerificationGas",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymasterAndData",type:"bytes"},{name:"signature",type:"bytes"}],name:"ops",type:"tuple[]"},{name:"beneficiary",type:"address"}],name:"handleOps",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{name:"key",type:"uint192"}],name:"incrementNonce",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{name:"callData",type:"bytes"},{components:[{components:[{name:"sender",type:"address"},{name:"nonce",type:"uint256"},{name:"callGasLimit",type:"uint256"},{name:"verificationGasLimit",type:"uint256"},{name:"preVerificationGas",type:"uint256"},{name:"paymaster",type:"address"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"}],name:"mUserOp",type:"tuple"},{name:"userOpHash",type:"bytes32"},{name:"prefund",type:"uint256"},{name:"contextOffset",type:"uint256"},{name:"preOpGas",type:"uint256"}],name:"opInfo",type:"tuple"},{name:"context",type:"bytes"}],name:"innerHandleOp",outputs:[{name:"actualGasCost",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{name:"",type:"address"},{name:"",type:"uint192"}],name:"nonceSequenceNumber",outputs:[{name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{components:[{name:"sender",type:"address"},{name:"nonce",type:"uint256"},{name:"initCode",type:"bytes"},{name:"callData",type:"bytes"},{name:"callGasLimit",type:"uint256"},{name:"verificationGasLimit",type:"uint256"},{name:"preVerificationGas",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymasterAndData",type:"bytes"},{name:"signature",type:"bytes"}],name:"op",type:"tuple"},{name:"target",type:"address"},{name:"targetCallData",type:"bytes"}],name:"simulateHandleOp",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{components:[{name:"sender",type:"address"},{name:"nonce",type:"uint256"},{name:"initCode",type:"bytes"},{name:"callData",type:"bytes"},{name:"callGasLimit",type:"uint256"},{name:"verificationGasLimit",type:"uint256"},{name:"preVerificationGas",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymasterAndData",type:"bytes"},{name:"signature",type:"bytes"}],name:"userOp",type:"tuple"}],name:"simulateValidation",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"unlockStake",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{name:"withdrawAddress",type:"address"}],name:"withdrawStake",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{name:"withdrawAddress",type:"address"},{name:"withdrawAmount",type:"uint256"}],name:"withdrawTo",outputs:[],stateMutability:"nonpayable",type:"function"},{stateMutability:"payable",type:"receive"}],qt="0x5FF137D4b0FDCD49DcA30c7CF57E578a026d2789";function Ce(e,t={}){const{forHash:a}=t,{authorization:n,factory:i,factoryData:o}=e;return a&&(i==="0x7702"||i==="0x7702000000000000000000000000000000000000")?n?I([n.address,o??"0x"]):"0x7702000000000000000000000000000000000000":i?I([i,o??"0x"]):"0x"}const Le="0x22e325a297439656";function Se(e,t={}){const{callGasLimit:a,callData:n,maxPriorityFeePerGas:i,maxFeePerGas:o,paymaster:r,paymasterData:s,paymasterPostOpGasLimit:u,paymasterSignature:c,paymasterVerificationGasLimit:p,sender:l,signature:h="0x",verificationGasLimit:f}=e,x=I([D(m(f||0n),{size:16}),D(m(a||0n),{size:16})]),b=Ce(e,t),P=I([D(m(i||0n),{size:16}),D(m(o||0n),{size:16})]),v=e.nonce??0n,g=r?I([r,D(m(p||0n),{size:16}),D(m(u||0n),{size:16}),s||"0x",...c?t.forHash?[Le]:[c,D(m(Xe(c)),{size:2}),Le]:[]]):"0x",O=e.preVerificationGas??0n;return{accountGasLimits:x,callData:n,initCode:b,gasFees:P,nonce:v,paymasterAndData:g,preVerificationGas:O,sender:l,signature:h}}const Pt={PackedUserOperation:[{type:"address",name:"sender"},{type:"uint256",name:"nonce"},{type:"bytes",name:"initCode"},{type:"bytes",name:"callData"},{type:"bytes32",name:"accountGasLimits"},{type:"uint256",name:"preVerificationGas"},{type:"bytes32",name:"gasFees"},{type:"bytes",name:"paymasterAndData"}]};function xt(e){const{chainId:t,entryPointAddress:a,userOperation:n}=e,i=Se(n,{forHash:!0});return{types:Pt,primaryType:"PackedUserOperation",domain:{name:"ERC4337",version:"1",chainId:t,verifyingContract:a},message:i}}function ea(e){const{chainId:t,entryPointAddress:a,entryPointVersion:n}=e,i=e.userOperation,{authorization:o,callData:r="0x",callGasLimit:s,maxFeePerGas:u,maxPriorityFeePerGas:c,nonce:p,paymasterAndData:l="0x",preVerificationGas:h,sender:f,verificationGasLimit:x}=i;if(n==="0.8"||n==="0.9")return Ye(xt({chainId:t,entryPointAddress:a,userOperation:i}));const b=(()=>{var P,v;if(n==="0.6"){const g=(P=i.initCode)==null?void 0:P.slice(0,42),O=(v=i.initCode)==null?void 0:v.slice(42),U=Ce({authorization:o,factory:g,factoryData:O},{forHash:!0});return S([{type:"address"},{type:"uint256"},{type:"bytes32"},{type:"bytes32"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"bytes32"}],[f,p,E(U),E(r),s,x,h,u,c,E(l)])}if(n==="0.7"){const g=Se(i,{forHash:!0});return S([{type:"address"},{type:"uint256"},{type:"bytes32"},{type:"bytes32"},{type:"bytes32"},{type:"uint256"},{type:"bytes32"},{type:"bytes32"}],[g.sender,g.nonce,E(g.initCode),E(g.callData),g.accountGasLimits,g.preVerificationGas,g.gasFees,E(g.paymasterAndData)])}throw new Error(`entryPointVersion "${n}" not supported.`)})();return E(S([{type:"bytes32"},{type:"address"},{type:"uint256"}],[E(b),a,BigInt(t)]))}async function ta(e){const{extend:t,nonceKeyManager:a=mt({source:{get(){return Date.now()},set(){}}}),...n}=e;let i=!1;const o=await e.getAddress();return{...t,...n,address:o,async getFactoryArgs(){return"isDeployed"in this&&await this.isDeployed()?{factory:void 0,factoryData:void 0}:e.getFactoryArgs()},async getNonce(r){const s=(r==null?void 0:r.key)??BigInt(await a.consume({address:o,chainId:e.client.chain.id,client:e.client}));return e.getNonce?await e.getNonce({...r,key:s}):await Qe(e.client,{abi:qe(["function getNonce(address, uint192) pure returns (uint256)"]),address:e.entryPoint.address,functionName:"getNonce",args:[o,s]})},async isDeployed(){return i?!0:(i=!!await G(e.client,Je,"getCode")({address:o}),i)},...e.sign?{async sign(r){const[{factory:s,factoryData:u},c]=await Promise.all([this.getFactoryArgs(),e.sign(r)]);return s&&u?K({address:s,data:u,signature:c}):c}}:{},async signMessage(r){const[{factory:s,factoryData:u},c]=await Promise.all([this.getFactoryArgs(),e.signMessage(r)]);return s&&u&&s!=="0x7702"?K({address:s,data:u,signature:c}):c},async signTypedData(r){const[{factory:s,factoryData:u},c]=await Promise.all([this.getFactoryArgs(),e.signTypedData(r)]);return s&&u&&s!=="0x7702"?K({address:s,data:u,signature:c}):c},type:"smart"}}class X extends d{constructor({cause:t}){super("Smart Account is not deployed.",{cause:t,metaMessages:["This could arise when:","- No `factory`/`factoryData` or `initCode` properties are provided for Smart Account deployment.","- An incorrect `sender` address is provided."],name:"AccountNotDeployedError"})}}Object.defineProperty(X,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa20/});class A extends d{constructor({cause:t,data:a,message:n}={}){var o;const i=(o=n==null?void 0:n.replace("execution reverted: ",""))==null?void 0:o.replace("execution reverted","");super(`Execution reverted ${i?`with reason: ${i}`:"for an unknown reason"}.`,{cause:t,name:"ExecutionRevertedError"}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=a}}Object.defineProperty(A,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32521});Object.defineProperty(A,"message",{enumerable:!0,configurable:!0,writable:!0,value:/execution reverted/});class Y extends d{constructor({cause:t}){super("Failed to send funds to beneficiary.",{cause:t,name:"FailedToSendToBeneficiaryError"})}}Object.defineProperty(Y,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa91/});class J extends d{constructor({cause:t}){super("Gas value overflowed.",{cause:t,metaMessages:["This could arise when:","- one of the gas values exceeded 2**120 (uint120)"].filter(Boolean),name:"GasValuesOverflowError"})}}Object.defineProperty(J,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa94/});class Q extends d{constructor({cause:t}){super("The `handleOps` function was called by the Bundler with a gas limit too low.",{cause:t,name:"HandleOpsOutOfGasError"})}}Object.defineProperty(Q,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa95/});class q extends d{constructor({cause:t,factory:a,factoryData:n,initCode:i}){super("Failed to simulate deployment for Smart Account.",{cause:t,metaMessages:["This could arise when:","- Invalid `factory`/`factoryData` or `initCode` properties are present","- Smart Account deployment execution ran out of gas (low `verificationGasLimit` value)",`- Smart Account deployment execution reverted with an error
`,a&&`factory: ${a}`,n&&`factoryData: ${n}`,i&&`initCode: ${i}`].filter(Boolean),name:"InitCodeFailedError"})}}Object.defineProperty(q,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa13/});class ee extends d{constructor({cause:t,factory:a,factoryData:n,initCode:i}){super("Smart Account initialization implementation did not create an account.",{cause:t,metaMessages:["This could arise when:","- `factory`/`factoryData` or `initCode` properties are invalid",`- Smart Account initialization implementation is incorrect
`,a&&`factory: ${a}`,n&&`factoryData: ${n}`,i&&`initCode: ${i}`].filter(Boolean),name:"InitCodeMustCreateSenderError"})}}Object.defineProperty(ee,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa15/});class te extends d{constructor({cause:t,factory:a,factoryData:n,initCode:i,sender:o}){super("Smart Account initialization implementation does not return the expected sender.",{cause:t,metaMessages:["This could arise when:",`Smart Account initialization implementation does not return a sender address
`,a&&`factory: ${a}`,n&&`factoryData: ${n}`,i&&`initCode: ${i}`,o&&`sender: ${o}`].filter(Boolean),name:"InitCodeMustReturnSenderError"})}}Object.defineProperty(te,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa14/});class ae extends d{constructor({cause:t}){super("Smart Account does not have sufficient funds to execute the User Operation.",{cause:t,metaMessages:["This could arise when:","- the Smart Account does not have sufficient funds to cover the required prefund, or","- a Paymaster was not provided"].filter(Boolean),name:"InsufficientPrefundError"})}}Object.defineProperty(ae,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa21/});class ne extends d{constructor({cause:t}){super("Bundler attempted to call an invalid function on the EntryPoint.",{cause:t,name:"InternalCallOnlyError"})}}Object.defineProperty(ne,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa92/});class re extends d{constructor({cause:t}){super("Bundler used an invalid aggregator for handling aggregated User Operations.",{cause:t,name:"InvalidAggregatorError"})}}Object.defineProperty(re,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa96/});class ie extends d{constructor({cause:t,nonce:a}){super("Invalid Smart Account nonce used for User Operation.",{cause:t,metaMessages:[a&&`nonce: ${a}`].filter(Boolean),name:"InvalidAccountNonceError"})}}Object.defineProperty(ie,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa25/});class se extends d{constructor({cause:t}){super("Bundler has not set a beneficiary address.",{cause:t,name:"InvalidBeneficiaryError"})}}Object.defineProperty(se,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa90/});class k extends d{constructor({cause:t}){super("Invalid fields set on User Operation.",{cause:t,name:"InvalidFieldsError"})}}Object.defineProperty(k,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32602});class oe extends d{constructor({cause:t,paymasterAndData:a}){super("Paymaster properties provided are invalid.",{cause:t,metaMessages:["This could arise when:","- the `paymasterAndData` property is of an incorrect length\n",a&&`paymasterAndData: ${a}`].filter(Boolean),name:"InvalidPaymasterAndDataError"})}}Object.defineProperty(oe,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa93/});class L extends d{constructor({cause:t}){super("Paymaster deposit for the User Operation is too low.",{cause:t,metaMessages:["This could arise when:","- the Paymaster has deposited less than the expected amount via the `deposit` function"].filter(Boolean),name:"PaymasterDepositTooLowError"})}}Object.defineProperty(L,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32508});Object.defineProperty(L,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa31/});class fe extends d{constructor({cause:t}){super("The `validatePaymasterUserOp` function on the Paymaster reverted.",{cause:t,name:"PaymasterFunctionRevertedError"})}}Object.defineProperty(fe,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa33/});class ue extends d{constructor({cause:t}){super("The Paymaster contract has not been deployed.",{cause:t,name:"PaymasterNotDeployedError"})}}Object.defineProperty(ue,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa30/});class V extends d{constructor({cause:t}){super("UserOperation rejected because paymaster (or signature aggregator) is throttled/banned.",{cause:t,name:"PaymasterRateLimitError"})}}Object.defineProperty(V,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32504});class j extends d{constructor({cause:t}){super("UserOperation rejected because paymaster (or signature aggregator) is throttled/banned.",{cause:t,name:"PaymasterStakeTooLowError"})}}Object.defineProperty(j,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32505});class ce extends d{constructor({cause:t}){super("Paymaster `postOp` function reverted.",{cause:t,name:"PaymasterPostOpFunctionRevertedError"})}}Object.defineProperty(ce,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa50/});class de extends d{constructor({cause:t,factory:a,factoryData:n,initCode:i}){super("Smart Account has already been deployed.",{cause:t,metaMessages:["Remove the following properties and try again:",a&&"`factory`",n&&"`factoryData`",i&&"`initCode`"].filter(Boolean),name:"SenderAlreadyConstructedError"})}}Object.defineProperty(de,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa10/});class T extends d{constructor({cause:t}){super("UserOperation rejected because account signature check failed (or paymaster signature, if the paymaster uses its data as signature).",{cause:t,name:"SignatureCheckFailedError"})}}Object.defineProperty(T,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32507});class pe extends d{constructor({cause:t}){super("The `validateUserOp` function on the Smart Account reverted.",{cause:t,name:"SmartAccountFunctionRevertedError"})}}Object.defineProperty(pe,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa23/});class M extends d{constructor({cause:t}){super("UserOperation rejected because account specified unsupported signature aggregator.",{cause:t,name:"UnsupportedSignatureAggregatorError"})}}Object.defineProperty(M,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32506});class ye extends d{constructor({cause:t}){super("User Operation expired.",{cause:t,metaMessages:["This could arise when:","- the `validAfter` or `validUntil` values returned from `validateUserOp` on the Smart Account are not satisfied"].filter(Boolean),name:"UserOperationExpiredError"})}}Object.defineProperty(ye,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa22/});class me extends d{constructor({cause:t}){super("Paymaster for User Operation expired.",{cause:t,metaMessages:["This could arise when:","- the `validAfter` or `validUntil` values returned from `validatePaymasterUserOp` on the Paymaster are not satisfied"].filter(Boolean),name:"UserOperationPaymasterExpiredError"})}}Object.defineProperty(me,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa32/});class le extends d{constructor({cause:t}){super("Signature provided for the User Operation is invalid.",{cause:t,metaMessages:["This could arise when:","- the `signature` for the User Operation is incorrectly computed, and unable to be verified by the Smart Account"].filter(Boolean),name:"UserOperationSignatureError"})}}Object.defineProperty(le,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa24/});class ge extends d{constructor({cause:t}){super("Signature provided for the User Operation is invalid.",{cause:t,metaMessages:["This could arise when:","- the `signature` for the User Operation is incorrectly computed, and unable to be verified by the Paymaster"].filter(Boolean),name:"UserOperationPaymasterSignatureError"})}}Object.defineProperty(ge,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa34/});class R extends d{constructor({cause:t}){super("User Operation rejected by EntryPoint's `simulateValidation` during account creation or validation.",{cause:t,name:"UserOperationRejectedByEntryPointError"})}}Object.defineProperty(R,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32500});class z extends d{constructor({cause:t}){super("User Operation rejected by Paymaster's `validatePaymasterUserOp`.",{cause:t,name:"UserOperationRejectedByPaymasterError"})}}Object.defineProperty(z,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32501});class $ extends d{constructor({cause:t}){super("User Operation rejected with op code validation error.",{cause:t,name:"UserOperationRejectedByOpCodeError"})}}Object.defineProperty($,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32502});class N extends d{constructor({cause:t}){super("UserOperation out of time-range: either wallet or paymaster returned a time-range, and it is already expired (or will expire soon).",{cause:t,name:"UserOperationOutOfTimeRangeError"})}}Object.defineProperty(N,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32503});class Ot extends d{constructor({cause:t}){super(`An error occurred while executing user operation: ${t==null?void 0:t.shortMessage}`,{cause:t,name:"UnknownBundlerError"})}}class be extends d{constructor({cause:t}){super("User Operation verification gas limit exceeded.",{cause:t,metaMessages:["This could arise when:","- the gas used for verification exceeded the `verificationGasLimit`"].filter(Boolean),name:"VerificationGasLimitExceededError"})}}Object.defineProperty(be,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa40/});class we extends d{constructor({cause:t}){super("User Operation verification gas limit is too low.",{cause:t,metaMessages:["This could arise when:","- the `verificationGasLimit` is too low to verify the User Operation"].filter(Boolean),name:"VerificationGasLimitTooLowError"})}}Object.defineProperty(we,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa41/});class vt extends d{constructor(t,{callData:a,callGasLimit:n,docsPath:i,factory:o,factoryData:r,initCode:s,maxFeePerGas:u,maxPriorityFeePerGas:c,nonce:p,paymaster:l,paymasterAndData:h,paymasterData:f,paymasterPostOpGasLimit:x,paymasterVerificationGasLimit:b,preVerificationGas:P,sender:v,signature:g,verificationGasLimit:O}){const U=et({callData:a,callGasLimit:n,factory:o,factoryData:r,initCode:s,maxFeePerGas:typeof u<"u"&&`${Ee(u)} gwei`,maxPriorityFeePerGas:typeof c<"u"&&`${Ee(c)} gwei`,nonce:p,paymaster:l,paymasterAndData:h,paymasterData:f,paymasterPostOpGasLimit:x,paymasterVerificationGasLimit:b,preVerificationGas:P,sender:v,signature:g,verificationGasLimit:O});super(t.shortMessage,{cause:t,docsPath:i,metaMessages:[...t.metaMessages?[...t.metaMessages," "]:[],"Request Arguments:",U].filter(Boolean),name:"UserOperationExecutionError"}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cause=t}}class Gt extends d{constructor({hash:t}){super(`User Operation receipt with hash "${t}" could not be found. The User Operation may not have been processed yet.`,{name:"UserOperationReceiptNotFoundError"})}}class Dt extends d{constructor({hash:t}){super(`User Operation with hash "${t}" could not be found.`,{name:"UserOperationNotFoundError"})}}class Ue extends d{constructor({hash:t}){super(`Timed out while waiting for User Operation with hash "${t}" to be confirmed.`,{name:"WaitForUserOperationReceiptTimeoutError"})}}const Et=[A,k,L,V,j,T,M,N,R,z,$];function Lt(e,t){const a=(e.details||"").toLowerCase();if(X.message.test(a))return new X({cause:e});if(Y.message.test(a))return new Y({cause:e});if(J.message.test(a))return new J({cause:e});if(Q.message.test(a))return new Q({cause:e});if(q.message.test(a))return new q({cause:e,factory:t.factory,factoryData:t.factoryData,initCode:t.initCode});if(ee.message.test(a))return new ee({cause:e,factory:t.factory,factoryData:t.factoryData,initCode:t.initCode});if(te.message.test(a))return new te({cause:e,factory:t.factory,factoryData:t.factoryData,initCode:t.initCode,sender:t.sender});if(ae.message.test(a))return new ae({cause:e});if(ne.message.test(a))return new ne({cause:e});if(ie.message.test(a))return new ie({cause:e,nonce:t.nonce});if(re.message.test(a))return new re({cause:e});if(se.message.test(a))return new se({cause:e});if(oe.message.test(a))return new oe({cause:e});if(L.message.test(a))return new L({cause:e});if(fe.message.test(a))return new fe({cause:e});if(ue.message.test(a))return new ue({cause:e});if(ce.message.test(a))return new ce({cause:e});if(pe.message.test(a))return new pe({cause:e});if(de.message.test(a))return new de({cause:e,factory:t.factory,factoryData:t.factoryData,initCode:t.initCode});if(ye.message.test(a))return new ye({cause:e});if(me.message.test(a))return new me({cause:e});if(ge.message.test(a))return new ge({cause:e});if(le.message.test(a))return new le({cause:e});if(be.message.test(a))return new be({cause:e});if(we.message.test(a))return new we({cause:e});const n=e.walk(i=>Et.some(o=>o.code===i.code));if(n){if(n.code===A.code)return new A({cause:e,data:n.data,message:n.details});if(n.code===k.code)return new k({cause:e});if(n.code===L.code)return new L({cause:e});if(n.code===V.code)return new V({cause:e});if(n.code===j.code)return new j({cause:e});if(n.code===T.code)return new T({cause:e});if(n.code===M.code)return new M({cause:e});if(n.code===N.code)return new N({cause:e});if(n.code===R.code)return new R({cause:e});if(n.code===z.code)return new z({cause:e});if(n.code===$.code)return new $({cause:e})}return new Ot({cause:e})}function Be(e,{calls:t,docsPath:a,...n}){const i=(()=>{const o=Lt(e,n);if(t&&o instanceof A){const r=Ut(o),s=t==null?void 0:t.filter(u=>u.abi);if(r&&s.length>0)return It({calls:s,revertData:r})}return o})();return new vt(i,{docsPath:a,...n})}function Ut(e){let t;return e.walk(a=>{var i,o,r,s;const n=a;if(typeof n.data=="string"||typeof((i=n.data)==null?void 0:i.revertData)=="string"||!(n instanceof d)&&typeof n.message=="string"){const u=(s=(r=((o=n.data)==null?void 0:o.revertData)||n.data||n.message).match)==null?void 0:s.call(r,/(0x[A-Za-z0-9]*)/);if(u)return t=u[1],!0}return!1}),t}function It(e){const{calls:t,revertData:a}=e,{abi:n,functionName:i,args:o,to:r}=(()=>{const u=t==null?void 0:t.filter(p=>!!p.abi);if(u.length===1)return u[0];const c=u.filter(p=>{try{return!!tt({abi:p.abi,data:a})}catch{return!1}});return c.length===1?c[0]:{abi:[],functionName:u.reduce((p,l)=>`${p?`${p} | `:""}${l.functionName}`,""),args:void 0,to:void 0}})(),s=a==="0x"?new at({functionName:i}):new nt({abi:n,data:a,functionName:i});return new rt(s,{abi:n,args:o,contractAddress:r,functionName:i})}function At(e){const t={};return e.callGasLimit&&(t.callGasLimit=BigInt(e.callGasLimit)),e.preVerificationGas&&(t.preVerificationGas=BigInt(e.preVerificationGas)),e.verificationGasLimit&&(t.verificationGasLimit=BigInt(e.verificationGasLimit)),e.paymasterPostOpGasLimit&&(t.paymasterPostOpGasLimit=BigInt(e.paymasterPostOpGasLimit)),e.paymasterVerificationGasLimit&&(t.paymasterVerificationGasLimit=BigInt(e.paymasterVerificationGasLimit)),t}function W(e){const t={};return typeof e.callData<"u"&&(t.callData=e.callData),typeof e.callGasLimit<"u"&&(t.callGasLimit=m(e.callGasLimit)),typeof e.factory<"u"&&(t.factory=e.factory),typeof e.factoryData<"u"&&(t.factoryData=e.factoryData),typeof e.initCode<"u"&&(t.initCode=e.initCode),typeof e.maxFeePerGas<"u"&&(t.maxFeePerGas=m(e.maxFeePerGas)),typeof e.maxPriorityFeePerGas<"u"&&(t.maxPriorityFeePerGas=m(e.maxPriorityFeePerGas)),typeof e.nonce<"u"&&(t.nonce=m(e.nonce)),typeof e.paymaster<"u"&&(t.paymaster=e.paymaster),typeof e.paymasterAndData<"u"&&(t.paymasterAndData=e.paymasterAndData||"0x"),typeof e.paymasterData<"u"&&(t.paymasterData=e.paymasterData),typeof e.paymasterPostOpGasLimit<"u"&&(t.paymasterPostOpGasLimit=m(e.paymasterPostOpGasLimit)),typeof e.paymasterSignature<"u"&&(t.paymasterSignature=e.paymasterSignature),typeof e.paymasterVerificationGasLimit<"u"&&(t.paymasterVerificationGasLimit=m(e.paymasterVerificationGasLimit)),typeof e.preVerificationGas<"u"&&(t.preVerificationGas=m(e.preVerificationGas)),typeof e.sender<"u"&&(t.sender=e.sender),typeof e.signature<"u"&&(t.signature=e.signature),typeof e.verificationGasLimit<"u"&&(t.verificationGasLimit=m(e.verificationGasLimit)),typeof e.authorization<"u"&&(t.eip7702Auth=Ft(e.authorization)),t}function Ft(e){return{address:e.address,chainId:m(e.chainId),nonce:m(e.nonce),r:e.r?m(BigInt(e.r),{size:32}):D("0x",{size:32}),s:e.s?m(BigInt(e.s),{size:32}):D("0x",{size:32}),yParity:e.yParity?m(e.yParity,{size:1}):D("0x",{size:32})}}async function Ct(e,t){const{chainId:a,entryPointAddress:n,context:i,...o}=t,r=W(o),{paymasterPostOpGasLimit:s,paymasterVerificationGasLimit:u,...c}=await e.request({method:"pm_getPaymasterData",params:[{...r,callGasLimit:r.callGasLimit??"0x0",verificationGasLimit:r.verificationGasLimit??"0x0",preVerificationGas:r.preVerificationGas??"0x0"},n,m(a),i]});return{...c,...s&&{paymasterPostOpGasLimit:B(s)},...u&&{paymasterVerificationGasLimit:B(u)}}}async function St(e,t){const{chainId:a,entryPointAddress:n,context:i,...o}=t,r=W(o),{paymasterPostOpGasLimit:s,paymasterVerificationGasLimit:u,...c}=await e.request({method:"pm_getPaymasterStubData",params:[{...r,callGasLimit:r.callGasLimit??"0x0",verificationGasLimit:r.verificationGasLimit??"0x0",preVerificationGas:r.preVerificationGas??"0x0"},n,m(a),i]});return{...c,...s&&{paymasterPostOpGasLimit:B(s)},...u&&{paymasterVerificationGasLimit:B(u)}}}const Bt=["factory","fees","gas","paymaster","nonce","signature","authorization"];async function ve(e,t){var De;const a=t,{account:n=e.account,parameters:i=Bt,stateOverride:o}=a;if(!n)throw new _;const r=F(n),s=e,u=a.paymaster??(s==null?void 0:s.paymaster),c=typeof u=="string"?u:void 0,{getPaymasterStubData:p,getPaymasterData:l}=(()=>{if(u===!0)return{getPaymasterStubData:y=>G(s,St,"getPaymasterStubData")(y),getPaymasterData:y=>G(s,Ct,"getPaymasterData")(y)};if(typeof u=="object"){const{getPaymasterStubData:y,getPaymasterData:w}=u;return{getPaymasterStubData:w&&y?y:w,getPaymasterData:w&&y?w:void 0}}return{getPaymasterStubData:void 0,getPaymasterData:void 0}})(),h=a.paymasterContext?a.paymasterContext:s==null?void 0:s.paymasterContext;let f={...a,paymaster:c,sender:r.address};const[x,b,P,v,g]=await Promise.all([(async()=>a.calls?r.encodeCalls(a.calls.map(y=>{const w=y;return w.abi?{data:it(w),to:w.to,value:w.value}:w})):a.callData)(),(async()=>{if(!i.includes("factory"))return;if(a.initCode)return{initCode:a.initCode};if(a.factory&&a.factoryData)return{factory:a.factory,factoryData:a.factoryData};const{factory:y,factoryData:w}=await r.getFactoryArgs();return r.entryPoint.version==="0.6"?{initCode:y&&w?I([y,w]):void 0}:{factory:y,factoryData:w}})(),(async()=>{var y;if(i.includes("fees")){if(typeof a.maxFeePerGas=="bigint"&&typeof a.maxPriorityFeePerGas=="bigint")return f;if((y=s==null?void 0:s.userOperation)!=null&&y.estimateFeesPerGas){const w=await s.userOperation.estimateFeesPerGas({account:r,bundlerClient:s,userOperation:f});return{...f,...w}}try{const w=s.client??e,C=await G(w,st,"estimateFeesPerGas")({chain:w.chain,type:"eip1559"});return{maxFeePerGas:typeof a.maxFeePerGas=="bigint"?a.maxFeePerGas:BigInt(2n*C.maxFeePerGas),maxPriorityFeePerGas:typeof a.maxPriorityFeePerGas=="bigint"?a.maxPriorityFeePerGas:BigInt(2n*C.maxPriorityFeePerGas)}}catch{return}}})(),(async()=>{if(i.includes("nonce"))return typeof a.nonce=="bigint"?a.nonce:r.getNonce()})(),(async()=>{if(i.includes("authorization")){if(typeof a.authorization=="object")return a.authorization;if(r.authorization&&!await r.isDeployed())return{...await gt(r.client,r.authorization),r:"0xfffffffffffffffffffffffffffffff000000000000000000000000000000000",s:"0x7aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa",yParity:1}}})()]);typeof x<"u"&&(f.callData=x),typeof b<"u"&&(f={...f,...b}),typeof P<"u"&&(f={...f,...P}),typeof v<"u"&&(f.nonce=v),typeof g<"u"&&(f.authorization=g),i.includes("signature")&&(typeof a.signature<"u"?f.signature=a.signature:f.signature=await r.getStubSignature(f)),r.entryPoint.version==="0.6"&&!f.initCode&&(f.initCode="0x");let O;async function U(){return O||(e.chain?e.chain.id:(O=await G(e,he,"getChainId")({}),O))}let Ge=!1;if(i.includes("paymaster")&&p&&!c&&!a.paymasterAndData){const{isFinal:y=!1,sponsor:w,...C}=await p({chainId:await U(),entryPointAddress:r.entryPoint.address,context:h,...f});Ge=y,f={...f,...C}}if(r.entryPoint.version==="0.6"&&!f.paymasterAndData&&(f.paymasterAndData="0x"),i.includes("gas")){if((De=r.userOperation)!=null&&De.estimateGas){const y=await r.userOperation.estimateGas(f);f={...f,...y}}if(typeof f.callGasLimit>"u"||typeof f.preVerificationGas>"u"||typeof f.verificationGasLimit>"u"||f.paymaster&&typeof f.paymasterPostOpGasLimit>"u"||f.paymaster&&typeof f.paymasterVerificationGasLimit>"u"){const y=await G(s,ke,"estimateUserOperationGas")({account:r,callGasLimit:0n,preVerificationGas:0n,verificationGasLimit:0n,stateOverride:o,...f.paymaster?{paymasterPostOpGasLimit:0n,paymasterVerificationGasLimit:0n}:{},...f});f={...f,callGasLimit:f.callGasLimit??y.callGasLimit,preVerificationGas:f.preVerificationGas??y.preVerificationGas,verificationGasLimit:f.verificationGasLimit??y.verificationGasLimit,paymasterPostOpGasLimit:f.paymasterPostOpGasLimit??y.paymasterPostOpGasLimit,paymasterVerificationGasLimit:f.paymasterVerificationGasLimit??y.paymasterVerificationGasLimit}}}if(i.includes("paymaster")&&l&&!c&&!a.paymasterAndData&&!Ge){const y=await l({chainId:await U(),entryPointAddress:r.entryPoint.address,context:h,...f});f={...f,...y}}return delete f.calls,delete f.parameters,delete f.paymasterContext,typeof f.paymaster!="string"&&delete f.paymaster,f}async function ke(e,t){var u;const{account:a=e.account,entryPointAddress:n,stateOverride:i}=t;if(!a&&!t.sender)throw new _;const o=a?F(a):void 0,r=ot(i),s=o?await G(e,ve,"prepareUserOperation")({...t,parameters:["authorization","factory","nonce","paymaster","signature"]}):t;try{const c=[W(s),n??((u=o==null?void 0:o.entryPoint)==null?void 0:u.address)],p=await e.request({method:"eth_estimateUserOperationGas",params:r?[...c,r]:[...c]});return At(p)}catch(c){const p=t.calls;throw Be(c,{...s,...p?{calls:p}:{}})}}function kt(e){return e.request({method:"eth_supportedEntryPoints"})}function Vt(e){const t={...e};return e.callGasLimit&&(t.callGasLimit=BigInt(e.callGasLimit)),e.maxFeePerGas&&(t.maxFeePerGas=BigInt(e.maxFeePerGas)),e.maxPriorityFeePerGas&&(t.maxPriorityFeePerGas=BigInt(e.maxPriorityFeePerGas)),e.nonce&&(t.nonce=BigInt(e.nonce)),e.paymasterPostOpGasLimit&&(t.paymasterPostOpGasLimit=BigInt(e.paymasterPostOpGasLimit)),e.paymasterVerificationGasLimit&&(t.paymasterVerificationGasLimit=BigInt(e.paymasterVerificationGasLimit)),e.preVerificationGas&&(t.preVerificationGas=BigInt(e.preVerificationGas)),e.verificationGasLimit&&(t.verificationGasLimit=BigInt(e.verificationGasLimit)),t}async function jt(e,{hash:t}){const a=await e.request({method:"eth_getUserOperationByHash",params:[t]},{dedupe:!0});if(!a)throw new Dt({hash:t});const{blockHash:n,blockNumber:i,entryPoint:o,transactionHash:r,userOperation:s}=a;return{blockHash:n,blockNumber:BigInt(i),entryPoint:o,transactionHash:r,userOperation:Vt(s)}}function Tt(e){const t={...e};return e.actualGasCost&&(t.actualGasCost=BigInt(e.actualGasCost)),e.actualGasUsed&&(t.actualGasUsed=BigInt(e.actualGasUsed)),e.logs&&(t.logs=e.logs.map(a=>ft(a))),e.receipt&&(t.receipt=ut(t.receipt)),t}async function Ve(e,{hash:t}){const a=await e.request({method:"eth_getUserOperationReceipt",params:[t]},{dedupe:!0});if(!a)throw new Gt({hash:t});return Tt(a)}async function Mt(e,t){var u,c;const{account:a=e.account,entryPointAddress:n}=t;if(!a&&!t.sender)throw new _;const i=a?F(a):void 0,o=i?await G(e,ve,"prepareUserOperation")(t):t,r=t.signature||await((u=i==null?void 0:i.signUserOperation)==null?void 0:u.call(i,o)),s=W({...o,signature:r});try{return await e.request({method:"eth_sendUserOperation",params:[s,n??((c=i==null?void 0:i.entryPoint)==null?void 0:c.address)]},{retryCount:0})}catch(p){const l=t.calls;throw Be(p,{...o,...l?{calls:l}:{},signature:r})}}function Rt(e,t){const{hash:a,pollingInterval:n=e.pollingInterval,retryCount:i,timeout:o=12e4}=t;let r=0;const s=Ie(["waitForUserOperationReceipt",e.uid,a]);return new Promise((u,c)=>{const p=Ae(s,{resolve:u,reject:c},l=>{const h=b=>{x(),b(),p()},f=o?setTimeout(()=>h(()=>l.reject(new Ue({hash:a}))),o):void 0,x=Fe(async()=>{i&&r>=i&&(clearTimeout(f),h(()=>l.reject(new Ue({hash:a}))));try{const b=await G(e,Ve,"getUserOperationReceipt")({hash:a});clearTimeout(f),h(()=>l.resolve(b))}catch(b){const P=b;P.name!=="UserOperationReceiptNotFoundError"&&(clearTimeout(f),h(()=>l.reject(P)))}r++},{emitOnBegin:!0,interval:n});return x})})}function zt(e){return{estimateUserOperationGas:t=>ke(e,t),getChainId:()=>he(e),getSupportedEntryPoints:()=>kt(e),getUserOperation:t=>jt(e,t),getUserOperationReceipt:t=>Ve(e,t),prepareUserOperation:t=>ve(e,t),sendUserOperation:t=>Mt(e,t),waitForUserOperationReceipt:t=>Rt(e,t)}}function aa(e){const{client:t,key:a="bundler",name:n="Bundler Client",paymaster:i,paymasterContext:o,transport:r,userOperation:s}=e;return Object.assign(ct({...e,chain:e.chain??(t==null?void 0:t.chain),key:a,name:n,transport:r,type:"bundlerClient"}),{client:t,paymaster:i,paymasterContext:o,userOperation:s}).extend(zt)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const je={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},Te={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},Me={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},$t=xe(je.p),Nt=xe(Te.p),_t=xe(Me.p),Ht=Pe({...je,Fp:$t,lowS:!1},dt);Pe({...Te,Fp:Nt,lowS:!1},pt);Pe({...Me,Fp:_t,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},yt);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const na=Ht;export{ht as a,Qt as b,aa as c,Jt as d,qt as e,ea as f,Xt as g,Zt as h,na as p,Yt as s,ta as t,Kt as w};
